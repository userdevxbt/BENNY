/**
 * SHDWXBT - supabase-functions.js
 * Copyright (c) 2024-2026 SHDWXBT. All rights reserved.
 * 
 * PROPRIETARY AND CONFIDENTIAL
 * Unauthorized copying, modification, distribution, or use is strictly prohibited.
 * This code is protected by intellectual property laws.
 * 
 * Build: 2026-01-28T12:08:12.210Z
 * Checksum: SHDW-A1B1A3C
 */
function getSupabaseUrl(){return"undefined"!=typeof SHDWXBT_CONFIG&&SHDWXBT_CONFIG.SUPABASE_URL?SHDWXBT_CONFIG.SUPABASE_URL:""}function getSupabaseAnonKey(){return"undefined"!=typeof SHDWXBT_CONFIG&&SHDWXBT_CONFIG.SUPABASE_ANON_KEY?SHDWXBT_CONFIG.SUPABASE_ANON_KEY:""}class SupabaseFunctions{static async _request(t,r={}){const e=getSupabaseUrl(),n=getSupabaseAnonKey();if(!e||!n)throw new Error("Configuration not loaded");return fetch(`${e}${t}`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(r)})}static async analyzeSymbol(t,r){try{const e=await this._request("/functions/v1/analyze-symbol",{symbol:t,profile:r});if(!e.ok){const t=await e.json();throw new Error(t.error||e.statusText)}return await e.json()}catch(t){throw t}}static async scanMarket(t={}){try{t.profile;const r=t.maxSymbols||400,e=t.minConfluence||30,n=t.minVolume||3e6,a=t.route||"all",o=await this._request("/functions/v1/scan-market",{maxSymbols:r,minConfluence:e,minVolume:n,route:a});if(!o.ok){const t=await o.json();throw new Error(t.error||o.statusText)}return await o.json()}catch(t){throw t}}static async getOpportunities(t={}){try{const r=await this._request("/functions/v1/get-opportunities",{isActive:!1!==t.isActive,minConfluence:t.minConfluence||0,direction:t.direction,tradingProfile:t.tradingProfile,limit:t.limit||2e3});if(!r.ok){const t=await r.json();throw new Error(t.error||r.statusText)}return(await r.json()).data||[]}catch(t){return[]}}static async getWatchlist(t={}){try{const r=await this._request("/functions/v1/get-watchlist",{limit:t.limit||500});if(!r.ok){const t=await r.json();throw new Error(t.error||r.statusText)}return(await r.json()).data||[]}catch(t){return[]}}static async saveHotSignal(t){try{const r=await this._request("/functions/v1/save-hot-signal",{symbol:t.symbol,type:t.type,price:t.price,change:t.change,message:t.message,volume_spike:t.volumeSpike||null,timestamp:(new Date).toISOString()});if(!r.ok){const t=await r.json();throw new Error(t.error||r.statusText)}return await r.json()}catch(t){return console.warn("☁️ saveHotSignal error:",t),null}}static async getHotSignals(t={}){try{const r=await this._request("/functions/v1/get-hot-signals",{limit:t.limit||50,since:t.since||null,type:t.type||null});if(!r.ok){const t=await r.json();throw new Error(t.error||r.statusText)}return(await r.json()).data||[]}catch(t){return[]}}static async addToWatchlist(t,r={}){try{const e=await this._request("/functions/v1/add-to-watchlist",{symbol:t,reason:r.reason||"Manual add",confluence_score:r.confluenceScore||0,trend:r.trend||"neutral",current_price:r.currentPrice||0,notes:r.notes||""});if(!e.ok){const t=await e.json();throw new Error(t.error||e.statusText)}return await e.json()}catch(t){return console.warn("☁️ addToWatchlist error:",t),null}}static async removeFromWatchlist(t){try{const r=await this._request("/functions/v1/remove-from-watchlist",{symbol:t});if(!r.ok){const t=await r.json();throw new Error(t.error||r.statusText)}return await r.json()}catch(t){return console.warn("☁️ removeFromWatchlist error:",t),null}}static async promoteToOpportunity(t){try{const r=await this._request("/functions/v1/promote-to-opportunity",{symbol:t});if(!r.ok){const t=await r.json();throw new Error(t.error||r.statusText)}return await r.json()}catch(t){return console.warn("☁️ promoteToOpportunity error:",t),null}}static async markTarget(t,r,e,n,a="take_profit"){try{const o=await this._request("/functions/v1/mark-target",{symbol:t,tp_index:r,hit_price:e,direction:n,hit_type:a});if(!o.ok){const t=await o.json();throw new Error(t.error||o.statusText)}return await o.json()}catch(r){return console.warn(`☁️ markTarget error for ${t}:`,r),null}}static async generateAnalysisText(t){try{const r=await this._request("/functions/v1/generate-analysis-text",t);if(!r.ok){const t=await r.json();throw new Error(t.error||r.statusText)}return await r.json()}catch(t){throw t}}static async analyzeBatch(t,r,e=5){const n=[];for(let a=0;a<t.length;a+=e){const o=t.slice(a,a+e).map(t=>this.analyzeSymbol(t,r).catch(t=>null)),s=await Promise.all(o);n.push(...s.filter(t=>null!==t)),a+e<t.length&&await new Promise(t=>setTimeout(t,1e3))}return n}static async getPerformanceStats(){try{const t=await this._request("/functions/v1/get-performance-stats",{});if(!t.ok){const r=await t.json();throw new Error(r.error||t.statusText)}return await t.json()}catch(t){return console.warn("☁️ getPerformanceStats error:",t),{winRate:0,totalSignals:0,tpHits:0,slHits:0}}}static async checkFunctionsStatus(){const t=["analyze-symbol","scan-market","get-opportunities","get-watchlist","mark-target","save-hot-signal","get-hot-signals"],r={},e=getSupabaseUrl(),n=getSupabaseAnonKey();for(const a of t)try{const t=await fetch(`${e}/functions/v1/${a}`,{method:"OPTIONS",headers:{Authorization:`Bearer ${n}`}});r[a]=t.ok?"Online":"Offline"}catch(t){r[a]="Error"}return r}}const TRADING_PROFILES={scalping:{name:"Scalping",trigger:"5m",signal:"15m",target:"1h",anchor:"4h"},scalping515:{name:"Scalping 5/15",trigger:"5m",signal:"15m",target:"1h",anchor:"4h"},dayTrading:{name:"Day Trading",trigger:"15m",signal:"1h",target:"4h",anchor:"D"},swingTrading:{name:"Swing Trading",trigger:"4h",signal:"D",target:"W",anchor:"M"}};"undefined"!=typeof window&&(window.SupabaseFunctions=SupabaseFunctions,window.TRADING_PROFILES=TRADING_PROFILES),"undefined"!=typeof module&&module.exports&&(module.exports={SupabaseFunctions:SupabaseFunctions,TRADING_PROFILES:TRADING_PROFILES});