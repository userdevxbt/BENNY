/**
 * SHDWXBT - smart-alerts.js
 * Copyright (c) 2024-2026 SHDWXBT. All rights reserved.
 * 
 * PROPRIETARY AND CONFIDENTIAL
 * Unauthorized copying, modification, distribution, or use is strictly prohibited.
 * This code is protected by intellectual property laws.
 * 
 * Build: 2026-01-28T12:08:12.360Z
 * Checksum: SHDW-9C6D14F
 */
const SmartAlerts={config:{checkInterval:1e4,maxActiveAlerts:50,soundEnabled:!1,notifyMethods:["panel"]},state:{alerts:[],triggered:[],isRunning:!1,intervalId:null},alertTypes:{PRICE_ABOVE:"price_above",PRICE_BELOW:"price_below",PRICE_CROSS:"price_cross",RSI_OVERBOUGHT:"rsi_overbought",RSI_OVERSOLD:"rsi_oversold",EMA_CROSS_UP:"ema_cross_up",EMA_CROSS_DOWN:"ema_cross_down",VOLUME_SPIKE:"volume_spike",BREAKOUT:"breakout",BREAKDOWN:"breakdown",TP_NEAR:"tp_near",SL_NEAR:"sl_near",MTF_ALIGNMENT:"mtf_alignment"},createAlert(e){const t={id:`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,symbol:e.symbol,type:e.type,condition:e.condition,value:e.value,message:e.message||this.generateMessage(e),priority:e.priority||"normal",createdAt:new Date,expiresAt:e.expiresAt||null,triggered:!1,triggeredAt:null,triggerCount:0,maxTriggers:e.maxTriggers||1,cooldown:e.cooldown||6e4,lastTriggered:null,metadata:e.metadata||{}};return this.state.alerts.push(t),console.log(`ðŸ”” Alert created: ${t.id} - ${t.type} for ${t.symbol}`),this.saveAlerts(),t},generateMessage(e){return{[this.alertTypes.PRICE_ABOVE]:`ðŸš€ ${e.symbol} acima de $${e.value}`,[this.alertTypes.PRICE_BELOW]:`ðŸ“‰ ${e.symbol} abaixo de $${e.value}`,[this.alertTypes.RSI_OVERBOUGHT]:`âš ï¸ ${e.symbol} RSI sobrecomprado (>${e.value})`,[this.alertTypes.RSI_OVERSOLD]:`ðŸ’¡ ${e.symbol} RSI sobrevendido (<${e.value})`,[this.alertTypes.VOLUME_SPIKE]:`ðŸ“Š ${e.symbol} Volume spike detectado`,[this.alertTypes.BREAKOUT]:`ðŸ”¥ ${e.symbol} BREAKOUT acima de $${e.value}`,[this.alertTypes.BREAKDOWN]:`ðŸ’¥ ${e.symbol} BREAKDOWN abaixo de $${e.value}`,[this.alertTypes.TP_NEAR]:`ðŸŽ¯ ${e.symbol} prÃ³ximo do TP`,[this.alertTypes.SL_NEAR]:`âš ï¸ ${e.symbol} prÃ³ximo do Stop Loss`,[this.alertTypes.MTF_ALIGNMENT]:`âœ… ${e.symbol} MTF alinhado - ${e.value}`}[e.type]||`Alert: ${e.symbol} - ${e.type}`},removeAlert(e){const t=this.state.alerts.findIndex(t=>t.id===e);return-1!==t&&(this.state.alerts.splice(t,1),this.saveAlerts(),console.log(`ðŸ—‘ï¸ Alert removed: ${e}`),!0)},async checkAlerts(){const e=Date.now();for(const t of this.state.alerts)if(!(t.triggerCount>=t.maxTriggers||t.lastTriggered&&e-t.lastTriggered<t.cooldown||t.expiresAt&&new Date(t.expiresAt)<new Date))try{await this.evaluateCondition(t)&&this.triggerAlert(t)}catch(e){console.warn(`Error checking alert ${t.id}:`,e)}},async evaluateCondition(e){const t=await this.getCurrentPrice(e.symbol);if(!t)return!1;switch(e.type){case this.alertTypes.PRICE_ABOVE:return t>=e.value;case this.alertTypes.PRICE_BELOW:return t<=e.value;case this.alertTypes.PRICE_CROSS:const s=e.metadata.lastPrice||t;return e.metadata.lastPrice=t,s<e.value&&t>=e.value||s>e.value&&t<=e.value;case this.alertTypes.RSI_OVERBOUGHT:return await this.getRSI(e.symbol)>=(e.value||70);case this.alertTypes.RSI_OVERSOLD:return await this.getRSI(e.symbol)<=(e.value||30);case this.alertTypes.VOLUME_SPIKE:return await this.getVolumeRatio(e.symbol)>=(e.value||2);case this.alertTypes.TP_NEAR:return Math.abs(t-e.value)/e.value*100<=(e.metadata.threshold||.5);case this.alertTypes.SL_NEAR:return Math.abs(t-e.value)/e.value*100<=(e.metadata.threshold||.5);default:return!1}},triggerAlert(e){e.triggered=!0,e.triggeredAt=new Date,e.triggerCount++,e.lastTriggered=Date.now(),this.state.triggered.unshift({...e,triggeredAt:new Date}),this.state.triggered.length>100&&(this.state.triggered=this.state.triggered.slice(0,100)),this.notify(e),this.saveAlerts(),console.log(`ðŸ”” ALERT TRIGGERED: ${e.message}`)},notify(e){this.notifyPanel(e),this.config.notifyMethods.includes("browser")&&this.notifyBrowser(e),this.config.soundEnabled&&this.playSound(e.priority)},notifyPanel(e){const t=document.getElementById("alerts-container");if(!t)return;const s=document.createElement("div");s.className=`p-3 rounded-lg border ${{low:"bg-zinc-800 border-zinc-700",normal:"bg-blue-900/30 border-blue-700/50",high:"bg-yellow-900/30 border-yellow-700/50",critical:"bg-red-900/30 border-red-700/50"}[e.priority]} mb-2 animate-pulse`,s.innerHTML=`\n            <div class="flex justify-between items-start">\n                <div>\n                    <span class="font-bold text-white">${e.symbol}</span>\n                    <p class="text-sm text-zinc-300">${e.message}</p>\n                    <span class="text-xs text-zinc-500">${(new Date).toLocaleTimeString()}</span>\n                </div>\n                <button onclick="SmartAlerts.dismissNotification(this)" class="text-zinc-500 hover:text-white">âœ•</button>\n            </div>\n        `,t.insertBefore(s,t.firstChild),setTimeout(()=>{s.classList.add("opacity-0","transition-opacity"),setTimeout(()=>s.remove(),300)},3e4)},notifyBrowser(e){"Notification"in window&&("granted"===Notification.permission?new Notification("SHDWXBT Alert",{body:e.message,icon:"/favicon.ico",tag:e.id}):"denied"!==Notification.permission&&Notification.requestPermission())},playSound(e){},dismissNotification(e){const t=e.closest("div.p-3");t&&t.remove()},createOpportunityAlerts(e){const t=[];return e.entry_min&&t.push(this.createAlert({symbol:e.symbol,type:this.alertTypes.PRICE_BELOW,value:parseFloat(e.entry_max),message:`ðŸŽ¯ ${e.symbol} entrou na zona de entrada!`,priority:"high"})),e.tp1&&t.push(this.createAlert({symbol:e.symbol,type:this.alertTypes.TP_NEAR,value:parseFloat(e.tp1),message:`ðŸŽ¯ ${e.symbol} prÃ³ximo do TP1!`,priority:"high",metadata:{threshold:.5}})),e.tp2&&t.push(this.createAlert({symbol:e.symbol,type:this.alertTypes.TP_NEAR,value:parseFloat(e.tp2),message:`ðŸŽ¯ ${e.symbol} prÃ³ximo do TP2!`,priority:"high",metadata:{threshold:.5}})),e.stop_loss&&t.push(this.createAlert({symbol:e.symbol,type:this.alertTypes.SL_NEAR,value:parseFloat(e.stop_loss),message:`âš ï¸ ${e.symbol} prÃ³ximo do Stop Loss!`,priority:"critical",metadata:{threshold:.3}})),t},async getCurrentPrice(e){try{const t=await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${e}`),s=await t.json();return parseFloat(s.price)}catch(e){return null}},async getRSI(e,t=14){try{const s=await fetch(`https://api.binance.com/api/v3/klines?symbol=${e}&interval=1h&limit=${t+10}`),a=(await s.json()).map(e=>parseFloat(e[4])),r=[];for(let e=1;e<a.length;e++)r.push(a[e]-a[e-1]);const i=r.map(e=>e>0?e:0),l=r.map(e=>e<0?Math.abs(e):0),o=i.slice(-t).reduce((e,t)=>e+t,0)/t,n=l.slice(-t).reduce((e,t)=>e+t,0)/t;return 100-100/(1+(0===n?100:o/n))}catch(e){return 50}},async getVolumeRatio(e){try{const t=await fetch(`https://api.binance.com/api/v3/klines?symbol=${e}&interval=1h&limit=25`),s=(await t.json()).map(e=>parseFloat(e[5])),a=s[s.length-1];return a/(s.slice(0,-1).reduce((e,t)=>e+t,0)/(s.length-1))}catch(e){return 1}},start(){this.state.isRunning||(this.state.isRunning=!0,this.loadAlerts(),this.state.intervalId=setInterval(()=>{this.checkAlerts()},this.config.checkInterval),console.log("ðŸ”” Smart Alerts started"))},stop(){this.state.intervalId&&(clearInterval(this.state.intervalId),this.state.intervalId=null),this.state.isRunning=!1,console.log("ðŸ”• Smart Alerts stopped")},saveAlerts(){try{localStorage.setItem("shdwxbt_alerts",JSON.stringify(this.state.alerts))}catch(e){console.warn("Error saving alerts:",e)}},loadAlerts(){try{const e=localStorage.getItem("shdwxbt_alerts");e&&(this.state.alerts=JSON.parse(e),console.log(`ðŸ“‚ Loaded ${this.state.alerts.length} alerts`))}catch(e){console.warn("Error loading alerts:",e)}},getActiveAlerts(){return this.state.alerts.filter(e=>e.triggerCount<e.maxTriggers&&(!e.expiresAt||new Date(e.expiresAt)>new Date))},getTriggeredAlerts(){return this.state.triggered},clearAll(){this.state.alerts=[],this.state.triggered=[],this.saveAlerts(),console.log("ðŸ—‘ï¸ All alerts cleared")}};window.SmartAlerts=SmartAlerts,document.addEventListener("DOMContentLoaded",()=>{SmartAlerts.start()}),console.log("ðŸ”” Smart Alerts System loaded");